# T3 Stack Monorepo é¡¹ç›®æ€»ç»“

> åˆ›å»ºæ—¶é—´: 2026-01-28  
> æ›´æ–°æ—¶é—´: 2026-02-12  
> æ¶æ„: Monorepo (pnpm + Turborepo)  
> æ¸²æŸ“æ¨¡å¼: çº¯ CSR (Client-Side Rendering)

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è§ˆ](#é¡¹ç›®æ¦‚è§ˆ)
2. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
3. [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
4. [æƒé™æ¨¡å‹](#æƒé™æ¨¡å‹)
5. [æœåŠ¡è¯´æ˜](#æœåŠ¡è¯´æ˜)
6. [æ•°æ®æ¨¡å‹](#æ•°æ®æ¨¡å‹)
7. [ç›®å½•ç»“æ„](#ç›®å½•ç»“æ„)
8. [å¿«é€Ÿå¯åŠ¨](#å¿«é€Ÿå¯åŠ¨)

---

## é¡¹ç›®æ¦‚è§ˆ

åŸºäº **T3 Stack** æ„å»ºçš„ **Monorepo** å¤§å‹é¡¹ç›®æ¶æ„ Demoï¼š

| æ¨¡å— | è¯´æ˜ |
|-----|------|
| ğŸŒ **Web å‰ç«¯** | Next.js å…¨æ ˆåº”ç”¨ + NextAuth è®¤è¯ |
| ğŸ”§ **ç®¡ç†ç«¯æœåŠ¡** | tRPC Server - ç”¨æˆ·/å›¢é˜Ÿ/è§’è‰²/èœå•ç®¡ç† |
| âš™ï¸ **è¿è¡Œç«¯æœåŠ¡** | RESTful API - ä¸šåŠ¡è¿è¡Œï¼ˆå¾…å®ç°ï¼‰ |

### ä¸»è¦ç‰¹æ€§

- âœ… Monorepo æ¶æ„ (pnpm + Turborepo)
- âœ… **tRPC ç«¯åˆ°ç«¯ç±»å‹å®‰å…¨**ï¼ˆadmin-serviceï¼‰
- âœ… åŒå±‚è§’è‰²ä½“ç³»ï¼ˆç³»ç»Ÿè§’è‰² + å›¢é˜Ÿè§’è‰²ï¼‰
- âœ… åŠ¨æ€èœå•æƒé™ï¼ˆåŸºäºè§’è‰²çš„èœå•å¯è§æ€§ï¼‰
- âœ… å›¢é˜Ÿä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆTeamContext + TeamSwitcherï¼‰
- âœ… GitHub é£æ ¼æ·±è‰²ä¸»é¢˜ UI
- âœ… å…±äº«ç±»å‹å®šä¹‰å’Œæ•°æ®åº“
- âœ… **Admin ä¾§è¾¹æ å¸ƒå±€**ï¼ˆAdminLayout + AdminSidebarï¼‰
- âœ… å±‚çº§èœå•ç³»ç»Ÿï¼ˆ"ç³»ç»Ÿç®¡ç†" ä¸ºæ ¹èœå•ï¼‰
- âœ… å›¢é˜Ÿå±‚çº§çº¦æŸï¼ˆ"ç³»ç»Ÿç®¡ç†" ä¸ºå›ºå®šæ ¹å›¢é˜Ÿï¼‰
- âœ… **å¯¼èˆªæ å³ä¾§å¸ƒå±€**ï¼ˆç”¨æˆ·å + ç³»ç»Ÿè§’è‰² tooltip + å›¢é˜Ÿè§’è‰² + é€€å‡ºç™»å½•ï¼‰
- âœ… **å›¢é˜Ÿç®¡ç†æƒé™æ§åˆ¶**ï¼ˆå¯è§æ€§è¿‡æ»¤ + æ“ä½œæƒé™æ ¡éªŒï¼‰

---

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        web (å‰ç«¯)                               â”‚
â”‚                      Next.js :3000                              â”‚
â”‚  AdminLayout + AdminSidebar + Navigation + TeamSwitcher         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ tRPC                          â”‚ RESTful + axios
            â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   admin-service      â”‚        â”‚   runtime-service    â”‚
â”‚   :4001 (tRPC)       â”‚        â”‚   :4002 (RESTful)    â”‚
â”‚                      â”‚        â”‚                      â”‚
â”‚   èŒè´£:               â”‚        â”‚   èŒè´£:               â”‚
â”‚   - ç”¨æˆ·ç®¡ç†          â”‚        â”‚   - ä¸šåŠ¡è¿è¡Œ          â”‚
â”‚   - å›¢é˜Ÿç®¡ç†          â”‚        â”‚   - ä»»åŠ¡è°ƒåº¦          â”‚
â”‚   - è§’è‰²ç®¡ç†          â”‚        â”‚   - æ•°æ®å¤„ç†          â”‚
â”‚   - èœå•æƒé™          â”‚        â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                               â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚     @repo/database       â”‚
              â”‚     (Prisma + SQLite)    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é€šä¿¡åè®®å¯¹æ¯”

| æœåŠ¡ | åè®® | ç«¯å£ | ç‰¹ç‚¹ |
|-----|------|------|------|
| **admin-service** | tRPC | 4001 | ç«¯åˆ°ç«¯ç±»å‹å®‰å…¨ |
| **runtime-service** | RESTful + axios | 4002 | é€šç”¨æ¥å£ï¼ˆå¾…å®ç°ï¼‰ |

---

## æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | ç‰ˆæœ¬ |
|-----|------|------|
| **åŒ…ç®¡ç†** | pnpm + Turborepo | 9.x / 2.x |
| **å‰ç«¯** | Next.js + React | 15.x / 19.x |
| **æ ·å¼** | Tailwind CSS | 4.x |
| **è®¤è¯** | NextAuth.js | 5.0-beta |
| **åç«¯é€šä¿¡** | tRPC | 11.x |
| **æ•°æ®åº“** | Prisma + SQLite | 6.x |

---

## æƒé™æ¨¡å‹

### åŒå±‚è§’è‰²ä½“ç³»

```
ç³»ç»Ÿè§’è‰² (UserSystemRole)           å›¢é˜Ÿè§’è‰² (TeamRole)
â”œâ”€â”€ ADMIN â€” ç³»ç»Ÿç®¡ç†å‘˜               â”œâ”€â”€ å›¢é˜Ÿç®¡ç†å‘˜ (isAdmin=true)
â”‚   Â· å¯è§æ‰€æœ‰èœå•                   â”‚   Â· ç®¡ç†å›¢é˜Ÿè§’è‰²å’Œæˆå‘˜
â”‚   Â· ç®¡ç†ç”¨æˆ·ã€å›¢é˜Ÿã€èœå•            â”‚   Â· é…ç½®è§’è‰²èœå•æƒé™
â”‚   Â· å¯çœ‹åˆ°æ‰€æœ‰å›¢é˜Ÿ                 â”‚   Â· å¯ç®¡ç†å­å›¢é˜Ÿæˆå‘˜å’Œè§’è‰²
â”‚   Â· ä»…é€šè¿‡ Seed/DB åˆ†é…            â”‚   Â· æ— æ³•ä¿®æ”¹å…¶ä»–ç®¡ç†å‘˜çš„è§’è‰²
â”‚                                    â”‚
â””â”€â”€ USER â€” æ™®é€šç”¨æˆ·                  â””â”€â”€ è‡ªå®šä¹‰è§’è‰² (isAdmin=false)
    Â· å¯è§ SystemRoleMenu é…ç½®çš„èœå•      Â· å¯è§ TeamRoleMenu é…ç½®çš„èœå•
    Â· å¯åŠ å…¥å¤šä¸ªå›¢é˜Ÿ
    Â· åªèƒ½çœ‹åˆ°æ‰€åœ¨å›¢é˜ŸåŠå­å›¢é˜Ÿ
```

### èœå•å¯è§æ€§å…¬å¼

```
ç”¨æˆ·å¯è§èœå• = ADMIN ? å…¨éƒ¨èœå•
            : SystemRoleMenu(USER) âˆª TeamRoleMenu(å½“å‰å›¢é˜Ÿè§’è‰²)
```

### ç™»å½•æµç¨‹

```
ç™»å½•æˆåŠŸ â†’ æ£€æŸ¥ç³»ç»Ÿè§’è‰²
â”œâ”€â”€ ADMIN â†’ è‡ªåŠ¨é€‰æ‹©"ç³»ç»Ÿç®¡ç†"å›¢é˜Ÿ â†’ è¿›å…¥é¦–é¡µ
â””â”€â”€ USER  â†’ è·å–å›¢é˜Ÿåˆ—è¡¨
            â”œâ”€â”€ 0 ä¸ªå›¢é˜Ÿ â†’ ç›´æ¥è¿›å…¥é¦–é¡µ
            â”œâ”€â”€ 1 ä¸ªå›¢é˜Ÿ â†’ è‡ªåŠ¨é€‰æ‹© â†’ è¿›å…¥é¦–é¡µ
            â””â”€â”€ å¤šä¸ªå›¢é˜Ÿ â†’ æ˜¾ç¤ºé€‰æ‹©ç•Œé¢
```

### å›ºå®šç®¡ç†å‘˜å›¢é˜Ÿ

Seed ä¼šåˆ›å»ºä¸€ä¸ªå›ºå®šçš„ **"ç³»ç»Ÿç®¡ç†"** å›¢é˜Ÿï¼ˆid: `admin-team`ï¼‰ï¼ŒADMIN ç”¨æˆ·è‡ªåŠ¨åŠ å…¥ã€‚

- è¯¥å›¢é˜Ÿä¸å¯ç¼–è¾‘æˆ–åˆ é™¤
- åˆ›å»ºæ–°å›¢é˜Ÿæ—¶ï¼Œè‹¥æœªæŒ‡å®š `parentId`ï¼Œé»˜è®¤æŒ‚è½½åˆ° `admin-team` ä¸‹
- å›¢é˜Ÿç®¡ç†é¡µé¢ä¸æä¾›é¡¶çº§ "+" æŒ‰é’®ï¼Œä»…é€šè¿‡å›¢é˜ŸèŠ‚ç‚¹æ“ä½œæ·»åŠ å­å›¢é˜Ÿ

### å›¢é˜Ÿç®¡ç†æƒé™æ§åˆ¶

| è§„åˆ™ | è¯´æ˜ |
|------|------|
| **å¯è§æ€§** | ADMIN çœ‹æ‰€æœ‰å›¢é˜Ÿï¼›æ™®é€šç”¨æˆ·åªçœ‹æ‰€åœ¨å›¢é˜ŸåŠå…¶å­å›¢é˜Ÿï¼ˆä¸æ˜¾ç¤ºçˆ¶å›¢é˜Ÿï¼‰ |
| **åˆ›å»ºå­å›¢é˜Ÿ** | ç³»ç»Ÿç®¡ç†å‘˜æˆ–çˆ¶å›¢é˜Ÿ / ç¥–å…ˆå›¢é˜Ÿç®¡ç†å‘˜ |
| **æ·»åŠ æˆå‘˜** | ç³»ç»Ÿç®¡ç†å‘˜æˆ–å½“å‰ / ç¥–å…ˆå›¢é˜Ÿç®¡ç†å‘˜ |
| **ä¿®æ”¹æˆå‘˜è§’è‰²** | åŒä¸Šï¼Œä¸”ç›®æ ‡æˆå‘˜ä¸èƒ½æ˜¯ç®¡ç†å‘˜è§’è‰² |
| **ç§»é™¤æˆå‘˜** | ç³»ç»Ÿç®¡ç†å‘˜æˆ–å½“å‰ / ç¥–å…ˆå›¢é˜Ÿç®¡ç†å‘˜ |

åç«¯è¾…åŠ©å‡½æ•°ï¼š`isSystemAdmin(userId)` ã€ `isTeamAdmin(userId, teamId)` ã€ `isTeamOrAncestorAdmin(userId, teamId)`

### å±‚çº§èœå•ç³»ç»Ÿ

Seed ä¼šåˆ›å»º **"ç³»ç»Ÿç®¡ç†"** çˆ¶èœå•ï¼ˆpath: `/admin`ï¼‰ï¼Œä¸‹æŒ‚ä¸‰ä¸ªå­èœå•ï¼š
- ç”¨æˆ·ç®¡ç† (`/admin/users`)
- å›¢é˜Ÿç®¡ç† (`/admin/teams`)
- èœå•ç®¡ç† (`/admin/menus`)

èœå• API æ”¯æŒ 3 çº§é€’å½’æŸ¥è¯¢ï¼Œå­èœå•å¯è§æ—¶è‡ªåŠ¨åŒ…å«çˆ¶èœå•ã€‚

---

## æœåŠ¡è¯´æ˜

### apps/web - Web å‰ç«¯

| å±æ€§ | å€¼ |
|------|-----|
| ç«¯å£ | 3000 |
| è®¤è¯ | NextAuth.js |
| tRPC Client | `src/lib/trpc.ts`ï¼ˆVanilla Clientï¼ŒPromise é£æ ¼ï¼‰ |
| å›¢é˜Ÿä¸Šä¸‹æ–‡ | `_components/team-context.tsx` |
| é¡¶éƒ¨å¯¼èˆª | `_components/navigation.tsx`ï¼ˆä»…é¡¶çº§é“¾æ¥ï¼Œæ— ä¸‹æ‹‰ï¼‰ |
| ä¾§è¾¹æ å¯¼èˆª | `_components/admin-sidebar.tsx`ï¼ˆAdmin å­èœå•ï¼‰ |
| Admin å¸ƒå±€ | `admin/layout.tsx`ï¼ˆä¾§è¾¹æ  + å†…å®¹åŒºï¼‰ |
| ç”¨æˆ·å¯¼èˆª | `_components/user-nav.tsx`ï¼ˆç”¨æˆ·å + ç³»ç»Ÿè§’è‰² tooltip + å›¢é˜Ÿè§’è‰² badge + é€€å‡ºç™»å½•ï¼‰ |
| å›¢é˜Ÿåˆ‡æ¢ | `_components/team-switcher.tsx` |

**é¡µé¢è·¯ç”±**ï¼š

| è·¯ç”± | è¯´æ˜ |
|------|------|
| `/` | é¦–é¡µ |
| `/auth/signin` | ç™»å½•ï¼ˆå« ADMIN åˆ¤æ–­ + å›¢é˜Ÿé€‰æ‹©ï¼‰ |
| `/auth/register` | æ³¨å†Œ |
| `/admin` | ç³»ç»Ÿç®¡ç†å…¥å£ï¼ˆè‡ªåŠ¨é‡å®šå‘åˆ°ç¬¬ä¸€ä¸ªå­èœå•ï¼‰ |
| `/admin/users` | ç”¨æˆ·ç®¡ç†ï¼ˆåªè¯»è§’è‰²å±•ç¤ºï¼‰ |
| `/admin/teams` | å›¢é˜Ÿç®¡ç†ï¼ˆæ ‘å½¢ç»“æ„ + æˆå‘˜ç®¡ç†ï¼‰ |
| `/admin/teams/:id` | å›¢é˜Ÿè¯¦æƒ… |
| `/admin/teams/:id/roles` | å›¢é˜Ÿè§’è‰²ç®¡ç† + èœå•æƒé™é…ç½® |
| `/admin/menus` | ç³»ç»Ÿèœå•æƒé™é…ç½®ï¼ˆADMIN é…ç½® USER å¯è§èœå•ï¼‰ |

**API è·¯ç”±**ï¼š

| è·¯ç”± | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/auth/[...nextauth]` | GET/POST | NextAuth è®¤è¯ |
| `/api/auth/register` | POST | ç”¨æˆ·æ³¨å†Œï¼ˆbcryptjs åŠ å¯† + é»˜è®¤ USER è§’è‰²ï¼‰ |

---

### apps/admin-service - ç®¡ç†ç«¯ tRPC æœåŠ¡

| å±æ€§ | å€¼ |
|------|-----|
| ç«¯å£ | 4001 |
| åè®® | **tRPC** |
| å…¥å£ | `src/index.ts` |

**tRPC è·¯ç”±**ï¼š

| è·¯ç”± | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| **user** | | |
| `user.getAll` | query | è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆå«ç³»ç»Ÿè§’è‰²ï¼‰ |
| `user.getById` | query | è·å–å•ä¸ªç”¨æˆ·ï¼ˆå«ç³»ç»Ÿè§’è‰²ï¼‰ |
| `user.getStats` | query | è·å–ç”¨æˆ·ç»Ÿè®¡ |
| `user.create` | mutation | åˆ›å»ºç”¨æˆ·ï¼ˆè‡ªåŠ¨åˆ†é… USER è§’è‰²ï¼‰ |
| `user.update` | mutation | æ›´æ–°ç”¨æˆ· |
| `user.delete` | mutation | åˆ é™¤ç”¨æˆ· |
| **team** | | |
| `team.getAll` | query | è·å–å›¢é˜Ÿåˆ—è¡¨ï¼ˆæŒ‰ userId è¿‡æ»¤ï¼ŒADMIN è¿”å›å…¨éƒ¨ï¼Œæ™®é€šç”¨æˆ·è¿”å›æ‰€åœ¨å›¢é˜Ÿ+å­å›¢é˜Ÿï¼‰ |
| `team.getById` | query | è·å–å›¢é˜Ÿè¯¦æƒ…ï¼ˆå«æˆå‘˜ã€è§’è‰²ï¼‰ |
| `team.create` | mutation | åˆ›å»ºå›¢é˜Ÿï¼ˆéœ€ operatorIdï¼Œæ ¡éªŒçˆ¶/ç¥–å…ˆå›¢é˜Ÿç®¡ç†å‘˜ï¼‰ |
| `team.update` | mutation | æ›´æ–°å›¢é˜Ÿ |
| `team.delete` | mutation | åˆ é™¤å›¢é˜Ÿï¼ˆç¦æ­¢åˆ é™¤ admin-teamï¼Œçº§è”æ¸…ç†ï¼‰ |
| `team.addMember` | mutation | æ·»åŠ æˆå‘˜ï¼ˆéœ€ operatorIdï¼Œæ ¡éªŒå›¢é˜Ÿ/ç¥–å…ˆç®¡ç†å‘˜ï¼‰ |
| `team.updateMemberRole` | mutation | æ›´æ–°æˆå‘˜è§’è‰²ï¼ˆæ ¡éªŒç®¡ç†å‘˜ + ç›®æ ‡éç®¡ç†å‘˜ï¼‰ |
| `team.removeMember` | mutation | ç§»é™¤æˆå‘˜ï¼ˆéœ€ operatorIdï¼Œæ ¡éªŒç®¡ç†å‘˜ï¼‰ |
| `team.getUserTeams` | query | è·å–ç”¨æˆ·æ‰€å±å›¢é˜Ÿåˆ—è¡¨ |
| **role** | | |
| `role.getByTeam` | query | è·å–å›¢é˜Ÿè§’è‰²åˆ—è¡¨ |
| `role.create` | mutation | åˆ›å»ºå›¢é˜Ÿè§’è‰² |
| `role.update` | mutation | æ›´æ–°å›¢é˜Ÿè§’è‰² |
| `role.delete` | mutation | åˆ é™¤å›¢é˜Ÿè§’è‰²ï¼ˆéœ€æ— æˆå‘˜ï¼‰ |
| `role.getMenus` | query | è·å–è§’è‰²å…³è”çš„èœå• ID |
| `role.updateMenus` | mutation | æ›´æ–°è§’è‰²èœå•æƒé™ |
| **menu** | | |
| `menu.getAll` | query | è·å–æ‰€æœ‰èœå•ï¼ˆæ ‘å½¢ï¼Œæ”¯æŒ 3 çº§é€’å½’ï¼‰ |
| `menu.getUserMenus` | query | è·å–ç”¨æˆ·å¯è§èœå•ï¼ˆæŒ‰è§’è‰²ï¼Œè‡ªåŠ¨åŒ…å«çˆ¶èœå•ï¼‰ |
| `menu.updateUserRoleMenus` | mutation | é…ç½® USER å¯è§èœå• |
| `menu.getUserRoleMenuIds` | query | è·å– USER è§’è‰²èœå• IDï¼ˆå›æ˜¾ï¼‰ |

---

## æ•°æ®æ¨¡å‹

```prisma
model User {
    id          String   @id @default(cuid())
    name        String?
    email       String?  @unique
    password    String?
    status      String   @default("active")
    systemRoles UserSystemRole[]  // ç³»ç»Ÿè§’è‰²
    teamMembers TeamMember[]      // å›¢é˜Ÿæˆå‘˜å…³ç³»
}

model UserSystemRole {
    id     String @id @default(cuid())
    userId String
    role   String  // ADMIN / USERï¼ˆä»…é€šè¿‡ Seed åˆ†é… ADMINï¼‰
    @@unique([userId, role])
}

model Team {
    id          String  @id @default(cuid())
    name        String
    description String?
    parentId    String?
    parent      Team?   @relation("TeamHierarchy", ...)
    children    Team[]  @relation("TeamHierarchy")
    members     TeamMember[]
    roles       TeamRole[]
}

model TeamMember {
    id         String @id @default(cuid())
    userId     String
    teamId     String
    teamRoleId String       // å¼•ç”¨ TeamRole
    teamRole   TeamRole     @relation(...)
    @@unique([userId, teamId])
}

model TeamRole {
    id      String  @id @default(cuid())
    teamId  String
    name    String
    isAdmin Boolean @default(false)
    members TeamMember[]
    menus   TeamRoleMenu[]
    @@unique([teamId, name])
}

model Menu {
    id        String  @id @default(cuid())
    name      String
    path      String  @unique
    icon      String?
    sortOrder Int     @default(0)
    parentId  String?
    children  Menu[]  @relation("MenuHierarchy")
}

model SystemRoleMenu {
    id     String @id @default(cuid())
    role   String  // "USER"
    menuId String
    @@unique([role, menuId])
}

model TeamRoleMenu {
    id         String @id @default(cuid())
    teamRoleId String
    menuId     String
    @@unique([teamRoleId, menuId])
}
```

---

## ç›®å½•ç»“æ„

```
t3_stack_demo/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/                        # ğŸŒ Web å‰ç«¯ (Next.js)
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ _components/    # å…±äº«ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ admin-sidebar.tsx   # Admin ä¾§è¾¹æ 
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ navigation.tsx      # é¡¶éƒ¨å¯¼èˆª
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user-nav.tsx        # ç”¨æˆ·å¯¼èˆªï¼ˆç™»å½•/æ³¨é”€ï¼‰
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ team-switcher.tsx   # å›¢é˜Ÿåˆ‡æ¢å™¨
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ team-context.tsx    # å›¢é˜Ÿä¸Šä¸‹æ–‡
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ session-provider.tsx # Session Provider
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx          # Admin å¸ƒå±€ï¼ˆä¾§è¾¹æ  + å†…å®¹åŒºï¼‰
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx            # /admin é‡å®šå‘é¡µ
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ users/             # ç”¨æˆ·ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ teams/             # å›¢é˜Ÿç®¡ç† + è§’è‰²ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ menus/             # èœå•æƒé™é…ç½®
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ api/auth/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ [...nextauth]/     # NextAuth è·¯ç”±
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ register/          # æ³¨å†Œ API
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ auth/                  # ç™»å½•/æ³¨å†Œé¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ lib/trpc.ts                # tRPC Vanilla Client
â”‚   â”‚   â”‚   â”œâ”€â”€ trpc/types.ts              # tRPC ç±»å‹è¾…åŠ©
â”‚   â”‚   â”‚   â””â”€â”€ server/auth/               # NextAuth é…ç½®
â”‚   â”‚   â””â”€â”€ .env
â”‚   â”‚
â”‚   â”œâ”€â”€ admin-service/              # ğŸ”§ ç®¡ç†ç«¯ tRPC æœåŠ¡
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ trpc.ts             # tRPC åˆå§‹åŒ–
â”‚   â”‚       â”œâ”€â”€ index.ts            # Express + tRPC é€‚é…å™¨
â”‚   â”‚       â””â”€â”€ routers/
â”‚   â”‚           â”œâ”€â”€ _app.ts         # æ ¹è·¯ç”± (user + team + role + menu)
â”‚   â”‚           â”œâ”€â”€ user.ts         # ç”¨æˆ·è·¯ç”±
â”‚   â”‚           â”œâ”€â”€ team.ts         # å›¢é˜Ÿè·¯ç”±
â”‚   â”‚           â”œâ”€â”€ role.ts         # è§’è‰²è·¯ç”±
â”‚   â”‚           â””â”€â”€ menu.ts         # èœå•è·¯ç”±
â”‚   â”‚
â”‚   â””â”€â”€ runtime-service/            # âš™ï¸ è¿è¡Œç«¯ RESTful æœåŠ¡ï¼ˆå¾…å®ç°ï¼‰
â”‚
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ database/                   # ğŸ“¦ Prisma Schema + Client + Seed
â”‚   â””â”€â”€ types/                      # ğŸ“¦ å…±äº«ç±»å‹
â”‚
â””â”€â”€ .agent/                         # ğŸ“‹ é¡¹ç›®æ–‡æ¡£ & å¼€å‘è®¡åˆ’
    â”œâ”€â”€ PROJECT_SUMMARY.md          # æœ¬æ–‡æ¡£
    â””â”€â”€ plans/role-management/      # è§’è‰²ç®¡ç†è®¾è®¡æ–‡æ¡£
```

---

## å¿«é€Ÿå¯åŠ¨

```bash
# å®‰è£…ä¾èµ–
pnpm install

# åˆå§‹åŒ–æ•°æ®åº“
pnpm --filter database db:push

# æ‰§è¡Œ Seedï¼ˆåˆ›å»º ADMIN ç”¨æˆ· + ç³»ç»Ÿèœå• + ç®¡ç†å‘˜å›¢é˜Ÿï¼‰
pnpm --filter database db:seed

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
pnpm dev
```

**é»˜è®¤è´¦å·**ï¼š
- é‚®ç®±: `admin@system.com`
- å¯†ç : `admin`ï¼ˆæˆ– `ADMIN_PASSWORD` ç¯å¢ƒå˜é‡ï¼‰

**è®¿é—®åœ°å€**ï¼š
- Web å‰ç«¯: http://localhost:3000
- admin-service: http://localhost:4001/trpc

---

*æ›´æ–°äº 2026-02-12*
